<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <title>Preview Page</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui">
        <link rel="stylesheet" href="styles/preview.css?__inline=true">
        <script type="text/javascript" src="//use.typekit.net/xuz8gem.js"></script>
        <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
        <script>
            (function() {
                'use strict';

                var isProduction = (/^(www\.)?(cinema6\.com|ci6\.co)$/).test(window.location.hostname),
                    base = isProduction ? '//portal.cinema6.com' : '//staging.cinema6.com',
                    params = window._c6Params = window.location.search.replace(/^\?/, '')
                        .split('&')
                        .reduce(function(params, segment) {
                            var pair = segment.split('=')
                                .map(decodeURIComponent),
                                key = pair[0], value = pair[1];

                            if (key) {
                                params[key] = value;
                            }

                            return params;
                        }, {}),
                    c6 = window.c6 = {
                        isProduction: isProduction,
                        embeds: [],
                        gaAcctIdPlayer: (function(acc,mi,mx){
                            return acc+'-'+parseInt(
                                ((Math.random()*999999999)%(mx-mi+1))+mi,10
                            );
                        }('UA-44457821',31,35)),
                        gaAcctIdEmbed: (function(acc,mi,mx){
                            return acc+'-'+parseInt(
                                ((Math.random()*999999999)%(mx-mi+1))+mi,10
                            );
                        }('UA-44457821',6,30))
                    };

                function toQueryParams(object) {
                    return Object.keys(object)
                        .filter(function(key) {
                            return object[key] !== undefined;
                        })
                        .map(function(key) {
                            return [key, object[key]]
                                .map(encodeURIComponent)
                                .join('=');
                        })
                        .join('&');
                }

                function writeScript(src) {
                    document.write('<script src="' + src +'" charset="utf-8"><\/script>');
                }

                window.module = {
                    exports: {}
                };

                window.writeScript = writeScript;

                window.src = base + '/api/public/content/experience/' + params.id + '.js?' + toQueryParams({
                    container: params.container || 'embed',
                    campaign: params.campaign,
                    preview: 'true'
                });
                writeScript(src);
            }());
        </script>
        <script>
            var embedSrc;
            if (window.c6.isProduction) {
                embedSrc = '//lib.cinema6.com/c6embed/v1/c6embed.min.js';
            } else {
                window.__C6_DEBUG__ = true;
                window.__C6_URL_ROOT__ = window.location.protocol + '//staging.cinema6.com';
                window.__C6_APP_JS__ = 'https://s3.amazonaws.com/c6.dev/ext/c6embed/v1/app.js';
                embedSrc = '//s3.amazonaws.com/c6.dev/ext/c6embed/v1/c6embed.js';
                // embedSrc = './embed.js';
            }
        </script>
        <script>
            var experience = window.module.exports;
            window.c6 = {
                requireCache: {}
            };
            window.c6.requireCache[src] = experience;
        </script>
    </head>
    <body>
        <div class="ui__viewHolder clearfix">
            <div class="mast__group mast__group--previewMode">
                <header class="mast clearfix">
                    <div class="c6Brand c6Brand--logo c6Sprite--alpha">
                        <span class="ir">Cinema6</span>
                    </div>
                    <h1 class="mast__title">Previewing : &ldquo;<em><script>document.write('<strong>'+experience.data.title+'<\/strong>')</script></em>&rdquo;</h1>
                </header>
            </div>

            <div class="ui__previewHolder clearfix">
                <script>
                    var experience = window.module.exports,
                        params = window._c6Params,
                        splashData = experience.data.splash,
                        splashString = splashData.theme + ':' + splashData.ratio.replace('-', '/');

                    var attrString = (function toDataAttributes(obj) {
                        return Object.keys(obj)
                        .filter(function(key) {
                            return obj[key] !== undefined;
                        })
                        .map(function(key) {
                            return 'data-' + key + '=' + obj[key];
                        })
                        .join(' ');
                    })({
                        exp             : experience.id,
                        splash          : splashString,
                        container       : params.container,
                        campaign        : params.campaign,
                        preview         : 'true',
                        'player-version': params.playerVersion
                    });

                    document.write('<script src="' + embedSrc + '" ' + attrString + ' data-preload><\/script>');
                </script>
            </div>

            <div class="footer__group">
                <footer class="footer__main container">
                    &copy; Copyright 2014 Cinema6. All Rights Reserved.
                </footer>
            </div>
        </div>
    </body>
</html>
